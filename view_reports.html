<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Reports - AlphaMed Clinical Laboratory</title>
  <link rel="stylesheet" href="style.css">
  <script src="qrcode.min.js"></script>
</head>
<body>

  <div class="header">
    <h1>AlphaMed Clinical Laboratory</h1>
    <p>Patient Reports</p>
  </div>

  <div class="container">
    <h2>Search Patient Report</h2>
    <input type="text" id="searchId" placeholder="Enter Patient ID (e.g., P-...)" />
    <button onclick="loadReport()">Search</button>
  </div>

  <div class="container" id="report-container" style="display:none;">
    <div class="report-header">
      <div id="qrcode"></div>
      <img src="logo.png" alt="AlphaMed Logo">
      <h2 style="text-align:center; margin-top:60px;">AlphaMed Clinical Laboratory</h2>
      <h4 style="text-align:center;">Quality Assurance Through Advanced Technology</h4>
    </div>

    <div id="report-details"></div>

    <button onclick="window.print()" style="margin-top:20px;">ðŸ–¨ Print Report</button>
  </div>

  <script>
    function loadReport(){
      const id = document.getElementById("searchId").value.trim();
      const patients = JSON.parse(localStorage.getItem("patients") || "[]");
      const p = patients.find(x => x.id === id);

      if(p){
        document.getElementById("report-container").style.display = "block";
        document.getElementById("report-details").innerHTML = `
          <p><b>Patient ID:</b> ${p.id}</p>
          <p><b>Name:</b> ${p.name}</p>
          <p><b>Age:</b> ${p.age} | <b>Gender:</b> ${p.gender}</p>
          <p><b>Department:</b> ${p.department}</p>
          <p><b>Date Registered:</b> ${new Date(p.created).toLocaleString()}</p>
          <h3>Test Results</h3>
          <table border="1" width="100%" cellpadding="6" cellspacing="0" style="border-collapse:collapse; background:#2c2c2c; color:#eee;">
            <tr>
              <th>Test Name</th>
              <th>Result</th>
              <th>Unit</th>
              <th>Reference Range</th>
            </tr>
            ${
              (p.results || []).map(r => `
                <tr>
                  <td>${r.name}</td>
                  <td>${r.value}</td>
                  <td>${r.unit}</td>
                  <td>${r.range}</td>
                </tr>
              `).join("") || "<tr><td colspan='4'>No results added yet.</td></tr>"
            }
          </table>
        `;

        // QR Code with full report info
        document.getElementById("qrcode").innerHTML = "";
        new QRCode(document.getElementById("qrcode"), {
          text: `AlphaMed Clinical Laboratory Report
Patient ID: ${p.id}
Name: ${p.name}
Age: ${p.age}, Gender: ${p.gender}
Department: ${p.department}
Tests: ${(p.results || []).map(r => r.name + " ("+r.value+")").join(", ")}
Date: ${new Date(p.created).toLocaleString()}`,
          width: 100,
          height: 100
        });

      } else {
        alert("Patient not found!");
      }
    }
  </script>

</body>
</html>
