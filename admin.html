<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Alpha Lab</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header smallbar">
    <div class="brand"><img src="logo.svg" class="logo"><h1 class="small">Admin</h1></div>
    <nav class="nav"><a href="index.html">Home</a> <a href="register_patient.html">Register</a> <a href="view_reports.html">Reports</a></nav>
  </header>

  <main class="container">
    <h2>Admin Dashboard</h2>
    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px">
        <h3>Departments</h3>
        <div id="deptBox"></div>
      </div>
      <div style="flex:1;min-width:260px">
        <h3>Patients</h3>
        <div id="patientsBox"></div>
      </div>
    </div>

    <h3 style="margin-top:18px">Manage Users</h3>
    <form id="userForm">
      <div class="form-row">
        <input id="uname" placeholder="username" required>
        <select id="urole"><option value="admin">admin</option><option value="tech">tech</option></select>
        <button class="btn" type="submit">Add User</button>
      </div>
    </form>
    <div id="userList"></div>

  </main>

  <script src="tests.js"></script>
  <script>
    // render departments
    function renderDepts(){
      const box = document.getElementById('deptBox');
      box.innerHTML = departments.map(d=>`<div class="list-item"><strong>${d.name}</strong> <div class="small">${d.tests.length} tests</div></div>`).join('');
    }

    function renderPatients(){
      const box = document.getElementById('patientsBox');
      const patients = JSON.parse(localStorage.getItem('patients')||'[]');
      box.innerHTML = patients.length ? patients.slice().reverse().map(p=>`<div class="list-item"><strong>${p.name}</strong> (${p.id}) <div class="small">Dept: ${p.department}</div></div>`).join('') : '<div class="small">No patients</div>';
    }

    // manage users (stored in localStorage)
    function renderUsers(){
      const list = document.getElementById('userList');
      const users = JSON.parse(localStorage.getItem('lab_users')||'[]');
      list.innerHTML = users.length ? users.map(u=>`<div class="list-item"><strong>${u.username}</strong> - ${u.role}</div>`).join('') : '<div class="small">No users</div>';
    }

    document.getElementById('userForm').addEventListener('submit', function(e){
      e.preventDefault();
      const u = document.getElementById('uname').value.trim();
      const r = document.getElementById('urole').value;
      if (!u) return;
      const users = JSON.parse(localStorage.getItem('lab_users')||'[]');
      users.push({username:u, role:r});
      localStorage.setItem('lab_users', JSON.stringify(users));
      document.getElementById('uname').value = '';
      renderUsers();
    });

    // initial
    renderDepts();
    renderPatients();
    renderUsers();
  </script>
</body>
</html>
