<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Alpha Med Lab - Register Patient</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="form-container">
    <h1>Register New Patient</h1>

    <form id="patientForm">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" placeholder="Enter full name" required>

      <label for="age">Age</label>
      <input type="number" id="age" name="age" placeholder="Enter age" required>

      <label for="gender">Gender</label>
      <select id="gender" name="gender" required>
        <option value="">-- Select Gender --</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>

      <label for="department">Department</label>
      <select id="department" name="department" required>
        <option value="">-- Select Department --</option>
      </select>

      <label for="tests">Select Tests</label>
      <select id="tests" name="tests" multiple required>
        <!-- Tests will load here -->
      </select>

      <button type="submit">Register Patient</button>
    </form>
  </div>

  <script src="test-data.js"></script>
  <script>
    // Load departments
    const deptSelect = document.getElementById("department");
    const testSelect = document.getElementById("tests");

    const departments = Object.keys(testData);

    departments.forEach(dept => {
      const option = document.createElement("option");
      option.value = dept;
      option.textContent = dept;
      deptSelect.appendChild(option);
    });

    deptSelect.addEventListener("change", () => {
      testSelect.innerHTML = "";
      const selectedDept = deptSelect.value;
      if (selectedDept && testData[selectedDept]) {
        testData[selectedDept].forEach(test => {
          const option = document.createElement("option");
          option.value = test.name;
          option.textContent = `${test.name} (Normal: ${test.normalRange})`;
          testSelect.appendChild(option);
        });
      }
    });

    // Save patient
    document.getElementById("patientForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const patient = {
        name: document.getElementById("name").value,
        age: document.getElementById("age").value,
        gender: document.getElementById("gender").value,
        department: document.getElementById("department").value,
        tests: Array.from(testSelect.selectedOptions).map(o => o.value)
      };

      let patients = JSON.parse(localStorage.getItem("patients")) || [];
      patients.push(patient);
      localStorage.setItem("patients", JSON.stringify(patients));

      alert("Patient registered successfully!");
      document.getElementById("patientForm").reset();
    });
  </script>
</body>
</html>
