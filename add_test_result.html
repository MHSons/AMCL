<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Test Result</title>
  <style>
    body { background:#121212; color:#e0e0e0; font-family:Arial; padding:20px; }
    h2 { color:#00bcd4; }
    button { background:#00bcd4; border:none; padding:8px 15px; margin:5px;
      border-radius:6px; cursor:pointer; color:#fff; font-weight:bold;}
    button:hover { background:#0097a7; }
  </style>
</head>
<body>
  <h2>Add Test Results</h2>
  <div id="patientList"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let patients = JSON.parse(localStorage.getItem("patients")) || [];
      let reports = JSON.parse(localStorage.getItem("reports")) || [];
      const container = document.getElementById("patientList");

      if (patients.length === 0) {
        container.innerHTML = "<p style='color:red;'>No active patients found!</p>";
        return;
      }

      let html = "<ul>";
      patients.forEach(p => {
        html += `<li>${p.name} (${p.age} yrs, ${p.gender}) - ${p.department} / ${p.test}
          <button onclick="addResult(${p.id})">Add Result</button></li>`;
      });
      html += "</ul>";
      container.innerHTML = html;
    });

    function addResult(patientId) {
      let patients = JSON.parse(localStorage.getItem("patients")) || [];
      let reports = JSON.parse(localStorage.getItem("reports")) || [];
      let patient = patients.find(p => p.id === patientId);
      if (!patient) return alert("Patient not found!");

      let result = prompt(`Enter result for ${patient.name} (${patient.test}):`);
      if (!result) return;

      patient.results.push({
        test: patient.test,
        value: result,
        date: new Date().toLocaleString()
      });

      // Move to reports
      reports.push(patient);
      patients = patients.filter(p => p.id !== patientId);

      localStorage.setItem("patients", JSON.stringify(patients));
      localStorage.setItem("reports", JSON.stringify(reports));

      alert("Result saved and moved to reports!");
      location.reload();
    }
  </script>
</body>
</html>
